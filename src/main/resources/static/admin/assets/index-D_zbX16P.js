import{e as P}from"./examPaper-D6igJsSB.js";import{d as ae,H as oe,v,r as i,e as ne,j as u,o as d,c as f,a,w as o,m as s,F as I,C as T,u as _,I as U,n as V,t as E,l as ue,M as L,k as S,_ as se}from"./index-DXJQNOID.js";import{u as re}from"./enumitem-j20-ZoDl.js";const ie={class:"list-common-table"},de={class:"table-container"},ce="id",pe="top",me=!0,ve=ae({__name:"index",setup(fe){const b=oe(),y=re(),M=v(()=>y.user.levelEnum),K=v(()=>y.exam.examPaper.paperTypeEnum),n=i({paperType:void 0,subjectId:void 0,level:void 0}),D=i([]),z=i(0),g=i(-1),C=i(!1),m=i(!1),q=i(),B=v(()=>b.subjects),O=[{title:"ID",colKey:"id",width:100},{title:"试卷学科名称",colKey:"subjectId",width:150,cell:(l,{row:e})=>b.subjectEnumFormat(B.value,e.subjectId)},{title:"试卷标题",colKey:"name",ellipsis:{theme:"light"}},{title:"试卷类型",colKey:"paperType",width:150,cell:(l,{row:e})=>y.enumFormat(K.value,e.paperType)},{title:"试卷分数",colKey:"scoreStr",width:80},{title:"试卷题数",colKey:"questionCount",width:80},{title:"操作时间",colKey:"createTime",width:200},{align:"left",fixed:"right",width:160,colKey:"op",title:"操作"}],r=i({defaultPageSize:20,total:100,defaultCurrent:1}),$=l=>{var e;(e=l.pagination)!=null&&e.current&&(r.value.defaultCurrent=l.pagination.current,c())},c=async()=>{C.value=!0;try{const l={...n.value,pageIndex:r.value.defaultCurrent,pageSize:r.value.defaultPageSize};Object.keys(l).forEach(e=>{l[e]===""&&(l[e]=null)}),await P.pageList(l).then(e=>{D.value=e.list,z.value=e.total,r.value={...r.value,total:e.total}})}catch(l){console.log(l)}finally{C.value=!1}},A=()=>{Object.keys(n.value).forEach(l=>{n.value[l]===""&&(n.value[l]=null)}),r.value.defaultCurrent=1,c()},H=()=>{r.value.defaultCurrent=1,c()},Q=l=>{g.value=l,m.value=!0},F=()=>{g.value=-1},R=v(()=>"删除后，该试卷的所有信息将被清空，且无法恢复"),G=()=>{F()},J=async()=>{await P.deletePaper(g.value).then(()=>{m.value=!1,L.success("删除成功"),F(),c()}).catch(l=>{L.error(l)})},W=()=>{n.value.subjectId=void 0,q.value=B.value.filter(l=>l.level===n.value.level)},X=l=>{U.push({path:"/paper/edit",query:{id:l.id}})};return ne(()=>{b.initSubject(),c()}),(l,e)=>{const h=u("t-option"),k=u("t-select"),w=u("t-form-item"),p=u("t-col"),N=u("t-row"),x=u("t-button"),Y=u("t-form"),j=u("t-link"),Z=u("t-space"),ee=u("t-table"),te=u("t-dialog");return d(),f("div",ie,[a(Y,{ref:"form",data:n.value,"label-width":80,colon:"",onReset:H,onSubmit:A},{default:o(()=>[a(N,null,{default:o(()=>[a(p,{span:10},{default:o(()=>[a(N,{gutter:[24,24]},{default:o(()=>[a(p,{span:4},{default:o(()=>[a(w,{label:"题目年级",name:"level"},{default:o(()=>[a(k,{modelValue:n.value.level,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.level=t),class:"form-item-content",placeholder:"请选择题目年级",clearable:"",onChange:W},{default:o(()=>[e[5]||(e[5]=s(" > ")),(d(!0),f(I,null,T(M.value,t=>(d(),S(h,{key:t.key,label:t.value,value:t.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(p,{span:4},{default:o(()=>[a(w,{label:"题目学科",name:"subjectId"},{default:o(()=>[a(k,{modelValue:n.value.subjectId,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.subjectId=t),class:"form-item-content",placeholder:"请选择题目学科",clearable:""},{default:o(()=>[e[6]||(e[6]=s(" > ")),(d(!0),f(I,null,T(q.value,t=>(d(),S(h,{key:t.id,label:t.name+" ( "+t.levelName+" )",value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(p,{span:4},{default:o(()=>[a(w,{label:"试卷类型",name:"paperType"},{default:o(()=>[a(k,{modelValue:n.value.paperType,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.paperType=t),class:"form-item-content",placeholder:"请选择题目类型",clearable:""},{default:o(()=>[e[7]||(e[7]=s(" > ")),(d(!0),f(I,null,T(K.value,t=>(d(),S(h,{key:t.key,label:t.value,value:t.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(p,{span:2,class:"operation-container"},{default:o(()=>[a(x,{theme:"primary",onClick:e[3]||(e[3]=t=>_(U).push("/paper/edit"))},{default:o(()=>[s(V(_(E)("components.commonTable.add")),1)]),_:1}),a(x,{theme:"primary",type:"submit"},{default:o(()=>[s(V(_(E)("components.commonTable.query")),1)]),_:1}),a(x,{type:"reset",variant:"base",theme:"default"},{default:o(()=>[s(V(_(E)("components.commonTable.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["data"]),ue("div",de,[a(ee,{data:D.value,columns:O,"row-key":ce,"vertical-align":pe,hover:me,pagination:r.value,loading:C.value,onChange:$},{op:o(t=>[a(Z,null,{default:o(()=>[a(j,{theme:"primary"},{default:o(()=>e[8]||(e[8]=[s(" 预览 ")])),_:1}),a(j,{theme:"primary",onClick:le=>X(t.row)},{default:o(()=>e[9]||(e[9]=[s(" 编辑 ")])),_:2},1032,["onClick"]),a(j,{theme:"danger",onClick:le=>Q(t.row.id)},{default:o(()=>e[10]||(e[10]=[s(" 删除")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","pagination","loading"]),a(te,{visible:m.value,"onUpdate:visible":e[4]||(e[4]=t=>m.value=t),header:"确认删除当前所选试卷？",body:R.value,"on-cancel":G,onConfirm:J},null,8,["visible","body"])])])}}}),ge=se(ve,[["__scopeId","data-v-9fdb22c3"]]);export{ge as default};
