import{B as M,d as E,Q as j,r as i,R as B,j as s,o as x,k as q,w as o,a,m as _,c as O,C as R,F as z,M as I,P as F,e as $,n as L,u as S,t as A,l as Q,_ as W}from"./index-DXJQNOID.js";const P={pageList:f=>M.post({url:"/admin/message/page",data:f}),send:f=>M.post({url:"/admin/message/send",data:f})},G=E({__name:"DialogMessageForm",props:{visible:{type:Boolean,default:!1},data:Object},emits:["update:visible","refresh"],setup(f,{emit:c}){const g={title:"",content:"",receiveUserIds:void 0},b=j("form"),m=i(!1),v=i(!1),r=i({...g}),y=i([]),V=c,d=({validateResult:n,firstError:e})=>{e?(console.log("Errors: ",n),I.warning(e)):P.send(r.value).then(l=>{I.success("发送成功"),m.value=!1,V("refresh")}).catch(l=>{console.log("Errors: ",l),I.warning(l.message)})},k=()=>{m.value=!1,r.value={...g}},p=n=>{console.log(n),n&&(v.value=!0,F.selectByUserName({name:n}).then(e=>{y.value=e}).catch(e=>{console.log("Errors: ",e),I.warning(e.message)}).finally(()=>{v.value=!1}))};B(()=>m.value,n=>{V("update:visible",n)}),B(()=>f.visible,n=>{m.value=n}),B(()=>f.data,n=>{n&&(r.value=n)});const N={title:[{required:!0,message:"请输入标题",type:"error",trigger:"blur"}],content:[{required:!0,message:"请选择内容",type:"error",trigger:"blur"}]};return(n,e)=>{const l=s("t-input"),t=s("t-form-item"),D=s("t-textarea"),T=s("t-option"),h=s("t-select"),w=s("t-button"),U=s("t-form"),K=s("t-dialog");return x(),q(K,{ref_key:"form",ref:b,visible:m.value,"onUpdate:visible":e[3]||(e[3]=u=>m.value=u),header:"消息发送",width:680,footer:!1},{body:o(()=>[a(U,{ref_key:"form",ref:b,data:r.value,rules:N,"label-width":80,"label-align":"left",onSubmit:d},{default:o(()=>[a(t,{label:"标题",name:"title"},{default:o(()=>[a(l,{modelValue:r.value.title,"onUpdate:modelValue":e[0]||(e[0]=u=>r.value.title=u),autocomplete:"off",placeholder:"请输入消息标题"},null,8,["modelValue"])]),_:1}),a(t,{label:"内容",name:"content"},{default:o(()=>[a(D,{modelValue:r.value.content,"onUpdate:modelValue":e[1]||(e[1]=u=>r.value.content=u),style:{width:"480px"},placeholder:"请输入消息内容"},null,8,["modelValue"])]),_:1}),a(t,{label:"接收人",name:"receiveUserIds"},{default:o(()=>[a(h,{modelValue:r.value.receiveUserIds,"onUpdate:modelValue":e[2]||(e[2]=u=>r.value.receiveUserIds=u),class:"form-item-content",placeholder:"请选择用户",multiple:"",filterable:"",loading:v.value,"reserve-keyword":"",onSearch:p},{default:o(()=>[e[4]||(e[4]=_(" > ")),(x(!0),O(z,null,R(y.value,u=>(x(),q(T,{key:u.value,label:u.name,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),a(t,{style:{float:"right"}},{default:o(()=>[a(w,{variant:"outline",onClick:k},{default:o(()=>e[5]||(e[5]=[_("取消")])),_:1}),a(w,{theme:"primary",type:"submit"},{default:o(()=>e[6]||(e[6]=[_("确定")])),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),H={class:"list-common-table"},J={class:"table-container"},X="id",Y="top",Z=!0,ee=E({__name:"index",setup(f){const c=i({sendUserName:void 0}),g={title:"",content:"",receiveUserIds:void 0},b=i([]),m=i(0),v=i(!1),r=i(!1),y=i({...g}),V=[{title:"ID",colKey:"id",width:100},{title:"标题",colKey:"title",width:180},{title:"内容",colKey:"content"},{title:"发送人",colKey:"sendUserName",width:120},{title:"接收人",colKey:"receives",width:120},{title:"已读数量",colKey:"readCount",width:70},{title:"接收数量",colKey:"receiveUserCount",width:120},{title:"发送时间",colKey:"createTime",width:200}],d=i({defaultPageSize:20,total:100,defaultCurrent:1}),k=l=>{var t;(t=l.pagination)!=null&&t.current&&(d.value.defaultCurrent=l.pagination.current,p())},p=async()=>{v.value=!0;try{const l={...c.value,pageIndex:d.value.defaultCurrent,pageSize:d.value.defaultPageSize};Object.keys(l).forEach(t=>{l[t]===""&&(l[t]=null)}),await P.pageList(l).then(t=>{b.value=t.list,m.value=t.total,d.value={...d.value,total:t.total}})}catch(l){console.log(l)}finally{v.value=!1}},N=()=>{Object.keys(c.value).forEach(l=>{c.value[l]===""&&(c.value[l]=null)}),d.value.defaultCurrent=1,p()},n=()=>{d.value.defaultCurrent=1,p()},e=()=>{y.value={...g},r.value=!0};return $(()=>{p()}),(l,t)=>{const D=s("t-input"),T=s("t-form-item"),h=s("t-col"),w=s("t-row"),U=s("t-button"),K=s("t-form"),u=s("t-table");return x(),O("div",H,[a(K,{ref:"form",data:c.value,"label-width":80,colon:"",onReset:n,onSubmit:N},{default:o(()=>[a(w,null,{default:o(()=>[a(h,{span:10},{default:o(()=>[a(w,{gutter:[24,24]},{default:o(()=>[a(h,{span:4},{default:o(()=>[a(T,{label:"发送者用户名",name:"sendUserName"},{default:o(()=>[a(D,{modelValue:c.value.sendUserName,"onUpdate:modelValue":t[0]||(t[0]=C=>c.value.sendUserName=C),class:"form-item-content",type:"search",placeholder:"用户名",style:{minWidth:"134px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(h,{span:2,class:"operation-container"},{default:o(()=>[a(U,{theme:"primary",onClick:t[1]||(t[1]=C=>e())},{default:o(()=>[_(L(S(A)("components.commonTable.add")),1)]),_:1}),a(U,{theme:"primary",type:"submit"},{default:o(()=>[_(L(S(A)("components.commonTable.query")),1)]),_:1}),a(U,{type:"reset",variant:"base",theme:"default"},{default:o(()=>[_(L(S(A)("components.commonTable.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["data"]),Q("div",J,[a(u,{data:b.value,columns:V,"row-key":X,"vertical-align":Y,hover:Z,pagination:d.value,loading:v.value,onChange:k},null,8,["data","pagination","loading"]),a(G,{visible:r.value,"onUpdate:visible":t[2]||(t[2]=C=>r.value=C),data:y.value,onRefresh:t[3]||(t[3]=C=>p())},null,8,["visible","data"])])])}}}),ae=W(ee,[["__scopeId","data-v-df3c7146"]]);export{ae as default};
