import{d as _e,H as be,i as ye,g as qe,r as V,v as I,S as ke,e as Te,j as m,o as r,k as c,w as t,a as l,m as d,c as v,C as q,F as k,p as A,n as U,u as M,t as z,l as h,M as D,_ as Ve}from"./index-DXJQNOID.js";import{e as B}from"./examPaper-D6igJsSB.js";import{q as O,Q as Ie}from"./QuestionShowContent-CnIlYcF9.js";import{u as Ce}from"./enumitem-j20-ZoDl.js";const we={key:0,class:"question-list-box"},he={class:"list-box"},De={class:"list-qu"},Se={class:"list-opt"},Pe={class:"table-container"},je=_e({__name:"edit",setup(Ee){const T=Ce(),S=be(),x={id:void 0,level:void 0,subjectId:void 0,paperType:1,limitDateTime:[],name:"",suggestTime:void 0,titleItems:[]},H=ye(),G=qe(),J=V(),u=V({...x}),W=I(()=>T.user.levelEnum),$=I(()=>T.exam.question.typeEnum),L=I(()=>T.user.difficulty),X=I(()=>T.exam.examPaper.paperTypeEnum.filter(o=>o.key!==3)),N=I(()=>S.subjects),Y=V({level:[{required:!0,message:"请选择年级",trigger:"change"}],subjectId:[{required:!0,message:"请选择学科",trigger:"change"}],paperType:[{required:!0,message:"请选择试卷类型",trigger:"change"}],name:[{required:!0,message:"请输入试卷名称",trigger:"blur"}],suggestTime:[{required:!0,message:"请输入建议时长",trigger:"blur"}]}),Q=V(),n=ke({multipleSelection:[],showDialog:!1,queryParam:{id:void 0,questionType:void 0,subjectId:void 0,difficult:void 0,pageIndex:1,pageSize:5},listLoading:!0,tableData:[],total:0}),g=V({defaultPageSize:10,total:100,defaultCurrent:1}),F=V(),Z=()=>{u.value={...x}},ee=({validateResult:o,firstError:e})=>{e?(console.log("Errors: ",o),D.warning(e)):B.edit(u.value).then(i=>{D.success(u.value.id?"修改成功":"添加成功"),G.push("/paper/index")}).catch(i=>{console.log("Errors: ",i),D.warning(i.message)})},te=()=>{u.value.titleItems.push({name:`第${u.value.titleItems.length+1}大题`,questionItems:[]})},le=o=>{u.value.titleItems.splice(o,1)},P=async()=>{n.queryParam.subjectId=u.value.subjectId?u.value.subjectId:void 0,n.listLoading=!0,n.queryParam={...n.queryParam,pageIndex:g.value.defaultCurrent,pageSize:g.value.defaultPageSize},O.pageList(n.queryParam).then(o=>{n.tableData=o.list,n.total=o.total,g.value.total=o.total,g.value.defaultCurrent=o.pageNum,n.listLoading=!1}).catch(o=>{D.warning(o.message)})},ae=o=>{var e;(e=o.pagination)!=null&&e.current&&(g.value.defaultCurrent=o.pagination.current,P())},oe=(o,e)=>{n.multipleSelection=e.selectedRowData},ue=()=>{n.multipleSelection.forEach(o=>{O.select(o.id).then(e=>{F.value.questionItems.push(e)})}),n.showDialog=!1},ne=o=>{F.value=o,n.showDialog=!0,P()},se=(o,e)=>{const i=o.questionItems.findIndex(_=>_.id===e.id);i>-1&&o.questionItems.splice(i,1)},re=(o,e)=>{if(e<=0)return;const i=o.questionItems[e];o.questionItems[e]=o.questionItems[e-1],o.questionItems[e-1]=i},ie=(o,e)=>{if(e>=o.questionItems.length-1)return;const i=o.questionItems[e];o.questionItems[e]=o.questionItems[e+1],o.questionItems[e+1]=i},de=()=>{g.value.defaultCurrent=1,P()},me=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{title:"ID",colKey:"id",width:100},{title:"学科名称",colKey:"subjectId",width:150,cell:(o,{row:e})=>S.subjectEnumFormat(N.value,e.subjectId)},{title:"题目类型",colKey:"questionType",width:150,cell:(o,{row:e})=>T.enumFormat($.value,e.questionType)},{title:"题目标题",colKey:"shortTitle",ellipsis:{theme:"light"}},{title:"分数",colKey:"score",width:80},{title:"难度",colKey:"difficult",width:80,cell:(o,{row:e})=>`${e.difficult} (${T.enumFormat(L.value,e.difficult)})`}];return Te(()=>{const o=H.query.id;S.initSubject(()=>{Q.value=N.value}),o&&parseInt(o,10)!==0&&B.select(o).then(e=>{u.value=e})}),(o,e)=>{const i=m("t-option"),_=m("t-select"),p=m("t-form-item"),s=m("t-col"),b=m("t-row"),j=m("t-card"),E=m("t-input"),pe=m("t-input-number"),fe=m("t-date-range-picker"),f=m("t-button"),ce=m("t-alert"),K=m("t-form"),ve=m("t-table"),ge=m("t-dialog");return r(),c(K,{ref_key:"form",ref:J,class:"base-form",data:u.value,rules:Y.value,"label-align":"top","label-width":100,onReset:Z,onSubmit:ee},{default:t(()=>[l(b,{gutter:[8,8]},{default:t(()=>[l(s,{span:2},{default:t(()=>[l(j,{bordered:!1},{default:t(()=>[l(b,{gutter:[8,8]},{default:t(()=>[l(s,{span:12},{default:t(()=>[l(p,{label:"试卷年级",name:"level"},{default:t(()=>[l(_,{modelValue:u.value.level,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.level=a),class:"form-item-content",placeholder:"请选择试卷年级",clearable:""},{default:t(()=>[e[13]||(e[13]=d(" > ")),(r(!0),v(k,null,q(W.value,a=>(r(),c(i,{key:a.key,label:a.value,value:a.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(s,{span:12},{default:t(()=>[l(p,{label:"试卷学科",name:"subjectId"},{default:t(()=>[l(_,{modelValue:u.value.subjectId,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.subjectId=a),class:"form-item-content",placeholder:"请选择试卷学科",clearable:""},{default:t(()=>[e[14]||(e[14]=d(" > ")),(r(!0),v(k,null,q(Q.value,a=>(r(),c(i,{key:a.id,label:a.name+" ( "+a.levelName+" )",value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(s,{span:12},{default:t(()=>[l(p,{label:"试卷类型",name:"paperType"},{default:t(()=>[l(_,{modelValue:u.value.paperType,"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.paperType=a),class:"form-item-content",placeholder:"请选择试卷类型",clearable:""},{default:t(()=>[e[15]||(e[15]=d(" > ")),(r(!0),v(k,null,q(X.value,a=>(r(),c(i,{key:a.key,label:a.value,value:a.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(s,{span:10},{default:t(()=>[l(b,{gutter:[16,16]},{default:t(()=>[l(s,{span:12},{default:t(()=>[l(j,{bordered:!1},{default:t(()=>[l(b,null,{default:t(()=>[l(s,{span:10},{default:t(()=>[l(b,{gutter:[24,24]},{default:t(()=>[l(s,{span:3},{default:t(()=>[l(p,{label:"试卷名称",name:"name"},{default:t(()=>[l(E,{modelValue:u.value.name,"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.name=a),placeholder:"请输入试卷标题"},null,8,["modelValue"])]),_:1})]),_:1}),l(s,{span:4},{default:t(()=>[l(p,{label:"试卷时长",name:"suggestTime"},{default:t(()=>[l(pe,{modelValue:u.value.suggestTime,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value.suggestTime=a),min:1,placeholder:"请输入试卷时长","auto-width":""},null,8,["modelValue"])]),_:1})]),_:1}),u.value.paperType===2?(r(),c(s,{key:0,span:4},{default:t(()=>[l(p,{label:"试卷时间限制",name:"limitDateTime"},{default:t(()=>[l(fe,{modelValue:u.value.limitDateTime,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value.limitDateTime=a),clearable:"","enable-time-picker":"",placeholder:"请输入试卷时间限制"},null,8,["modelValue"])]),_:1})]),_:1})):A("",!0)]),_:1})]),_:1}),l(s,{span:2,class:"operation-container"},{default:t(()=>[l(f,{theme:"warning",onClick:e[6]||(e[6]=a=>te())},{default:t(()=>e[16]||(e[16]=[d(" 添加大题 ")])),_:1}),l(f,{theme:"primary",type:"submit"},{default:t(()=>[d(U(u.value.id?"修改":"添加")+"试卷 ",1)]),_:1}),l(f,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[d(U(M(z)("components.commonTable.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),u.value.titleItems.length!==0?(r(!0),v(k,{key:0},q(u.value.titleItems,(a,C)=>(r(),c(s,{key:C,span:12},{default:t(()=>[l(j,{bordered:!1,"header-bordered":""},{title:t(()=>[l(E,{modelValue:u.value.titleItems[C].name,"onUpdate:modelValue":y=>u.value.titleItems[C].name=y},null,8,["modelValue","onUpdate:modelValue"])]),actions:t(()=>[l(f,{theme:"primary",onClick:y=>ne(a)},{default:t(()=>e[17]||(e[17]=[d("添加试题")])),_:2},1032,["onClick"]),l(f,{theme:"danger",onClick:y=>le(C)},{default:t(()=>e[18]||(e[18]=[d("删除大题")])),_:2},1032,["onClick"])]),default:t(()=>[a.questionItems.length!==0?(r(),v("div",we,[(r(!0),v(k,null,q(a.questionItems,(y,w)=>(r(),c(p,{key:w,style:{"margin-bottom":"0px"}},{default:t(()=>[h("div",he,[h("div",De,[l(Ie,{question:y,"q-type":y.questionType,"q-index":w+1},null,8,["question","q-type","q-index"])]),h("div",Se,[l(f,{theme:"danger",onClick:R=>se(a,y)},{default:t(()=>e[19]||(e[19]=[d("移除本题")])),_:2},1032,["onClick"]),l(f,{theme:"default",style:{"margin-left":"0"},onClick:R=>re(a,w)},{default:t(()=>e[20]||(e[20]=[d("排序上序")])),_:2},1032,["onClick"]),l(f,{theme:"default",style:{"margin-left":"0"},onClick:R=>ie(a,w)},{default:t(()=>e[21]||(e[21]=[d("排序下序")])),_:2},1032,["onClick"])])])]),_:2},1024))),128))])):A("",!0)]),_:2},1024)]),_:2},1024))),128)):(r(),c(s,{key:1,span:12},{default:t(()=>[l(ce,{theme:"info"},{default:t(()=>e[22]||(e[22]=[d("点击右上角创建试卷题目部分吧！")])),_:1})]),_:1}))]),_:1})]),_:1})]),_:1}),l(ge,{visible:n.showDialog,"onUpdate:visible":e[12]||(e[12]=a=>n.showDialog=a),class:"list-common-table",header:"选择试题",width:"90vw",footer:!1},{default:t(()=>[l(K,{data:n.queryParam,"label-width":80,"label-align":"left",colon:""},{default:t(()=>[l(b,null,{default:t(()=>[l(s,{span:10},{default:t(()=>[l(b,{gutter:[24,24]},{default:t(()=>[l(s,{span:4},{default:t(()=>[l(p,{label:"ID",name:"id"},{default:t(()=>[l(E,{modelValue:n.queryParam.id,"onUpdate:modelValue":e[7]||(e[7]=a=>n.queryParam.id=a),placeholder:"请输入ID"},null,8,["modelValue"])]),_:1})]),_:1}),l(s,{span:4},{default:t(()=>[l(p,{label:"题目类型",name:"questionType"},{default:t(()=>[l(_,{modelValue:n.queryParam.questionType,"onUpdate:modelValue":e[8]||(e[8]=a=>n.queryParam.questionType=a),class:"form-item-content",placeholder:"请选择题目类型",clearable:""},{default:t(()=>[e[23]||(e[23]=d(" > ")),(r(!0),v(k,null,q($.value,a=>(r(),c(i,{key:a.key,label:a.value,value:a.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(s,{span:4},{default:t(()=>[l(p,{label:"题目难度",name:"difficult"},{default:t(()=>[l(_,{modelValue:n.queryParam.difficult,"onUpdate:modelValue":e[9]||(e[9]=a=>n.queryParam.difficult=a),class:"form-item-content",placeholder:"请选择题目类型",clearable:""},{default:t(()=>[e[24]||(e[24]=d(" > ")),(r(!0),v(k,null,q(L.value,a=>(r(),c(i,{key:a.key,label:a.value,value:a.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(s,{span:2,class:"operation-container"},{default:t(()=>[l(f,{theme:"warning",onClick:e[10]||(e[10]=a=>de())},{default:t(()=>[d(U(M(z)("components.commonTable.query")),1)]),_:1}),l(f,{theme:"primary",class:"form-submit-confirm",onClick:e[11]||(e[11]=a=>ue())},{default:t(()=>e[25]||(e[25]=[d(" 添加题目 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"]),h("div",Pe,[l(ve,{data:n.tableData,columns:me,"row-key":"id","vertical-align":"top",hover:"",bordered:"",pagination:g.value,loading:n.listLoading,onChange:ae,onSelectChange:oe},null,8,["data","pagination","loading"])])]),_:1},8,["visible"])]),_:1},8,["data","rules"])}}}),Ne=Ve(je,[["__scopeId","data-v-6655cc0d"]]);export{Ne as default};
