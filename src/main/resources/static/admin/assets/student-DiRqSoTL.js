import{d as Q,r as v,v as q,R as O,j as n,o as V,k as R,w as l,a as e,m as d,c as P,C as X,F as Y,P as N,M as w,K as ie,N as de,e as me,n as K,u as B,t as z,l as ce,_ as ve}from"./index-DXJQNOID.js";import{u as Z}from"./enumitem-j20-ZoDl.js";const pe=Q({__name:"DialogStudentForm",props:{visible:{type:Boolean,default:!1},data:Object},emits:["update:visible","refresh"],setup(A,{emit:x}){const y={id:null,role:1,userName:"",password:"",realName:"",age:void 0,sex:1,userLevel:void 0,status:1},f=v(!1),u=v({...y}),m=Z(),L=q(()=>m.user.levelEnum),U=x,C=({validateResult:i,firstError:a})=>{a?(console.log("Errors: ",i),w.warning(a)):N.createUser(u.value).then(_=>{w.success(u.value.id?"修改成功":"添加成功"),f.value=!1,U("refresh")}).catch(_=>{console.log("Errors: ",_),w.warning(_.message)})},k=()=>{f.value=!1,u.value={...y}};O(()=>f.value,i=>{U("update:visible",i)}),O(()=>A.visible,i=>{f.value=i}),O(()=>A.data,i=>{i&&(u.value=i)});const h={userName:[{required:!0,message:"请输入用户名",type:"error",trigger:"blur"}],realName:[{required:!0,message:"请输入姓名",type:"error",trigger:"blur"}],userLevel:[{required:!0,message:"请选择年级",type:"error",trigger:"blur"}],status:[{required:!0,message:"请选择状态",type:"error",trigger:"blur"}]};return(i,a)=>{const _=n("t-input"),g=n("t-form-item"),p=n("t-input-number"),F=n("t-option"),b=n("t-select"),I=n("t-radio"),M=n("t-radio-group"),D=n("t-button"),$=n("t-form"),S=n("t-dialog");return V(),R(S,{visible:f.value,"onUpdate:visible":a[6]||(a[6]=s=>f.value=s),header:u.value.id?"修改用户":"新增用户",width:680,footer:!1},{body:l(()=>[e($,{ref:"form",data:u.value,rules:h,"label-width":100,onSubmit:C},{default:l(()=>[e(g,{label:"用户名",name:"userName"},{default:l(()=>[e(_,{modelValue:u.value.userName,"onUpdate:modelValue":a[0]||(a[0]=s=>u.value.userName=s),style:{width:"480px"},autocomplete:"off",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(g,{label:"密码",name:"password"},{default:l(()=>[e(_,{modelValue:u.value.password,"onUpdate:modelValue":a[1]||(a[1]=s=>u.value.password=s),style:{width:"480px"},autocomplete:"off",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),e(g,{label:"姓名",name:"realName"},{default:l(()=>[e(_,{modelValue:u.value.realName,"onUpdate:modelValue":a[2]||(a[2]=s=>u.value.realName=s),placeholder:"请输入姓名",style:{width:"480px"}},null,8,["modelValue"])]),_:1}),e(g,{label:"年龄",name:"age"},{default:l(()=>[e(p,{modelValue:u.value.age,"onUpdate:modelValue":a[3]||(a[3]=s=>u.value.age=s),placeholder:"请输入年龄"},null,8,["modelValue"])]),_:1}),e(g,{label:"年级",name:"userLevel"},{default:l(()=>[e(b,{modelValue:u.value.userLevel,"onUpdate:modelValue":a[4]||(a[4]=s=>u.value.userLevel=s),class:"form-item-content",placeholder:"请选择年级",style:{width:"480px"}},{default:l(()=>[a[7]||(a[7]=d(" > ")),(V(!0),P(Y,null,X(L.value,s=>(V(),R(F,{key:s.key,label:s.value,value:s.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"状态",name:"status"},{default:l(()=>[e(M,{modelValue:u.value.status,"onUpdate:modelValue":a[5]||(a[5]=s=>u.value.status=s)},{default:l(()=>[e(I,{value:1},{default:l(()=>a[8]||(a[8]=[d("启用")])),_:1}),e(I,{value:2},{default:l(()=>a[9]||(a[9]=[d("禁用")])),_:1})]),_:1},8,["modelValue"])]),_:1}),e(g,{style:{float:"right"}},{default:l(()=>[e(D,{variant:"outline",onClick:k},{default:l(()=>a[10]||(a[10]=[d("取消")])),_:1}),e(D,{theme:"primary",type:"submit"},{default:l(()=>a[11]||(a[11]=[d("确定")])),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible","header"])}}}),fe={class:"list-common-table"},_e={class:"table-container"},ge="id",be="top",ye=!0,we=Q({__name:"student",setup(A){const x={id:null,userName:"",password:"",realName:"",age:18,sex:1,userLevel:void 0,status:1,role:1},y=Z(),f=q(()=>y.user.levelEnum),u=q(()=>y.user.statusBtn),m=v({role:1,userLevel:null,userName:null}),L=v([]),U=v(0),C=v(-1),k=v(!1),h=v(!1),i=v(!1),a=v({...x}),_={1:{label:"启用",theme:"success",icon:e(ie,null,null)},2:{label:"禁用",theme:"danger",icon:e(de,null,null)}},g=[{title:"ID",colKey:"id",width:50},{title:"用户UUID",colKey:"userUuid",width:150,ellipsis:{theme:"light",showArrow:!1}},{title:"用户名",colKey:"userName",width:150},{title:"真实姓名",colKey:"realName",width:150},{title:"年级",colKey:"userLevel",width:150,cell:(o,{row:t})=>y.enumFormat(f.value,t.userLevel)},{colKey:"status",title:"状态",width:120,cell:(o,{row:t})=>{const c=_[t.status];return e(n("t-tag"),{shape:"round",theme:c==null?void 0:c.theme,variant:"light-outline"},{default:()=>[c==null?void 0:c.icon,c==null?void 0:c.label]})}},{title:"操作时间",colKey:"createTime",width:200},{align:"left",fixed:"right",width:160,colKey:"op",title:"操作"}],p=v({defaultPageSize:20,total:100,defaultCurrent:1}),F=o=>{var t;(t=o.pagination)!=null&&t.current&&(p.value.defaultCurrent=o.pagination.current,b())},b=async()=>{k.value=!0;try{const o={...m.value,pageIndex:p.value.defaultCurrent,pageSize:p.value.defaultPageSize};Object.keys(o).forEach(t=>{o[t]===""&&(o[t]=null)}),await N.getUserPageList(o).then(t=>{L.value=t.list,U.value=t.total,p.value={...p.value,total:t.total}})}catch(o){console.log(o)}finally{k.value=!1}},I=()=>{Object.keys(m.value).forEach(o=>{m.value[o]===""&&(m.value[o]=null)}),p.value.defaultCurrent=1,b()},M=()=>{p.value.defaultCurrent=1,b()},D=async o=>{N.changeStatus(o.id).then(t=>{o.status=t,w.success("状态修改成功")}).catch(t=>{w.error(t)})},$=o=>{C.value=o,h.value=!0},S=()=>{C.value=-1},s=q(()=>"删除后，该用户的所有信息将被清空，且无法恢复"),ee=()=>{S()},te=async()=>{await N.deleteUser(C.value).then(()=>{h.value=!1,w.success("删除成功"),S(),b()}).catch(o=>{w.error(o)})},W=o=>{o?N.selectUser(o).then(t=>{a.value=t}):a.value={...x},i.value=!0};return me(()=>{b()}),(o,t)=>{const c=n("t-input"),G=n("t-form-item"),T=n("t-col"),le=n("t-option"),ae=n("t-select"),H=n("t-row"),j=n("t-button"),oe=n("t-form"),E=n("t-link"),ne=n("router-link"),ue=n("t-space"),se=n("t-table"),re=n("t-dialog");return V(),P("div",fe,[e(oe,{ref:"form",data:m.value,"label-width":80,colon:"",onReset:M,onSubmit:I},{default:l(()=>[e(H,null,{default:l(()=>[e(T,{span:10},{default:l(()=>[e(H,{gutter:[24,24]},{default:l(()=>[e(T,{span:4},{default:l(()=>[e(G,{label:"用户名",name:"userName"},{default:l(()=>[e(c,{modelValue:m.value.userName,"onUpdate:modelValue":t[0]||(t[0]=r=>m.value.userName=r),class:"form-item-content",type:"search",placeholder:"用户名",style:{minWidth:"134px"}},null,8,["modelValue"])]),_:1})]),_:1}),e(T,{span:4},{default:l(()=>[e(G,{label:"用户年级",name:"userLevel"},{default:l(()=>[e(ae,{modelValue:m.value.userLevel,"onUpdate:modelValue":t[1]||(t[1]=r=>m.value.userLevel=r),class:"form-item-content",placeholder:"年级",clearable:""},{default:l(()=>[t[6]||(t[6]=d(" > ")),(V(!0),P(Y,null,X(f.value,r=>(V(),R(le,{key:r.key,label:r.value,value:r.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(T,{span:2,class:"operation-container"},{default:l(()=>[e(j,{theme:"primary",onClick:t[2]||(t[2]=r=>W())},{default:l(()=>[d(K(B(z)("components.commonTable.add")),1)]),_:1}),e(j,{theme:"primary",type:"submit"},{default:l(()=>[d(K(B(z)("components.commonTable.query")),1)]),_:1}),e(j,{type:"reset",variant:"base",theme:"default"},{default:l(()=>[d(K(B(z)("components.commonTable.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["data"]),ce("div",_e,[e(se,{data:L.value,columns:g,"row-key":ge,"vertical-align":be,hover:ye,pagination:p.value,loading:k.value,onChange:F},{op:l(r=>[e(ue,null,{default:l(()=>[e(E,{theme:"primary",onClick:J=>D(r.row)},{default:l(()=>[d(K(B(y).enumFormat(u.value,r.row.status)),1)]),_:2},1032,["onClick"]),e(E,{theme:"primary",onClick:J=>W(r.row.id)},{default:l(()=>t[7]||(t[7]=[d(" 编辑 ")])),_:2},1032,["onClick"]),e(ne,{to:{path:"/log/index",query:{userId:r.row.id}}},{default:l(()=>[e(E,{theme:"primary"},{default:l(()=>t[8]||(t[8]=[d(" 日志 ")])),_:1})]),_:2},1032,["to"]),e(E,{theme:"danger",onClick:J=>$(r.row.id)},{default:l(()=>t[9]||(t[9]=[d(" 删除")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","pagination","loading"]),e(re,{visible:h.value,"onUpdate:visible":t[3]||(t[3]=r=>h.value=r),header:"确认删除当前所选用户？",body:s.value,"on-cancel":ee,onConfirm:te},null,8,["visible","body"]),e(pe,{visible:i.value,"onUpdate:visible":t[4]||(t[4]=r=>i.value=r),data:a.value,onRefresh:t[5]||(t[5]=r=>b())},null,8,["visible","data"])])])}}}),Ce=ve(we,[["__scopeId","data-v-49f3f0fc"]]);export{Ce as default};
