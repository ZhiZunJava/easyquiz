import{d as ee,i as te,g as le,H as ae,v as S,r as x,S as se,R as ne,e as oe,M as v,j as u,o as g,c as V,a as l,w as s,l as c,m as f,n as C,F as q,C as w,k as I,_ as ue}from"./index-DXJQNOID.js";import{q as M}from"./QuestionShowContent-CnIlYcF9.js";import{u as ie}from"./enumitem-j20-ZoDl.js";import{_ as re}from"./QuestionShow.vue_vue_type_script_setup_true_lang-DNZVCb38.js";import{c as T}from"./constants-CezdDX0L.js";const de={class:"form-basic-container"},me={class:"form-basic-item"},ce={class:"form-basic-container-title"},fe={style:{display:"flex",width:"100%"}},pe={style:{flex:"1"}},ge={class:"form-submit-container"},ve={class:"form-submit-sub"},_e={class:"form-submit-left"},be=ee({__name:"gap-filling",setup(xe){const D=te(),F=le(),U=ae(),N=ie(),z=S(()=>N.user.levelEnum),E=x(null),k=S(()=>U.subjects),h=x(),_=x(!1),t=x({...T,items:[]}),A={gradeLevel:[{required:!0,message:"请选择年级",trigger:"change"}],subjectId:[{required:!0,message:"请选择学科",trigger:"change"}],title:[{required:!0,message:"请输入题干",trigger:"blur"}],analyze:[{required:!0,message:"请输入解析",trigger:"blur"}],score:[{required:!0,message:"请输入分数",trigger:"blur"}],correct:[{required:!0,message:"请选择正确答案",trigger:"change"}],difficult:[{required:!0,message:"请选择难度",trigger:"change"}]},p=se({qType:0,dialog:!1,question:{}}),B=()=>{t.value.subjectId=void 0,h.value=k.value.filter(o=>o.level===t.value.gradeLevel)},$=()=>{p.qType=4,p.dialog=!0,p.question=t.value},P=()=>{t.value={...T,items:[]},v.success("重置成功")};function G(){const o="0123456789abcdef";let e="";for(let a=0;a<36;a++)a===8||a===13||a===18||a===23?e+="-":a===14?e+="4":a===19?e+=o[Math.floor(Math.random()*4)+8]:e+=o[Math.floor(Math.random()*16)];return e}const H=()=>{const o=G(),e=t.value.items?t.value.items.length+1:1,a=`<span class="gapfilling-span ${o}">${e}</span>`,r=E.value;if(r){const i=r.selectionStart,d=r.selectionEnd,m=t.value.title;t.value.title=m.substring(0,i)+a+m.substring(d),t.value.items.push({prefix:e.toString(),content:"",itemUuid:o})}},O=({validateResult:o,firstError:e})=>{e?(console.log("Errors: ",o),v.warning(e)):M.edit(t.value).then(a=>{v.success(t.value.id?"修改成功":"添加成功"),F.push("/question")}).catch(a=>{console.log("Errors: ",a),v.warning(a.message)})};function Q(o,e){let a=null;return(...r)=>{a&&clearTimeout(a),a=window.setTimeout(()=>{o(...r),a=null},e)}}const J=Q(o=>{if(!t.value.items||t.value.items.length===0)return;const e=[];t.value.items.forEach(a=>{if(new RegExp(a.itemUuid).test(o)){const i=o.match(new RegExp(`class="gapfilling-span ${a.itemUuid}">(.*?)</span>`));if(i&&i[1]!==a.prefix){const[,d]=i;a.prefix=d}e.push(a)}}),e.length<t.value.items.length?t.value.items=e:e.length===t.value.items.length&&t.value.items.forEach((a,r)=>{const[i]=[e[r]];i&&i.prefix!==a.prefix&&(a.prefix=i.prefix)})},500);return ne(()=>t.value.title,o=>{J(o)},{deep:!0}),oe(()=>{const{id:o}=D.query;o&&parseInt(o,10)!==0&&(t.value.id=o,_.value=!0,M.select(o).then(e=>{t.value=e,_.value=!1}).catch(e=>{_.value=!1,v.error(e.message)})),U.initSubject(()=>{h.value=k.value})}),(o,e)=>{const a=u("t-tag"),r=u("t-option"),i=u("t-select"),d=u("t-form-item"),m=u("t-col"),b=u("t-button"),K=u("t-textarea"),L=u("t-input"),j=u("t-input-number"),W=u("t-input-adornment"),R=u("t-row"),X=u("t-rate"),Y=u("t-form"),Z=u("t-loading");return g(),V("div",null,[l(Z,{loading:_.value},{default:s(()=>[l(Y,{ref:"form",class:"base-form",data:t.value,rules:A,"label-align":"top","label-width":100,onReset:P,onSubmit:O},{default:s(()=>[c("div",de,[c("div",me,[c("div",ce,[e[7]||(e[7]=c("span",null,"填空题管理",-1)),e[8]||(e[8]=f()),l(a,{theme:"primary"},{default:s(()=>[f(C(t.value.id?"修改":"新增"),1)]),_:1})]),l(R,{class:"row-gap",gutter:[32,24]},{default:s(()=>[l(m,{span:6},{default:s(()=>[l(d,{label:"题目年级",name:"gradeLevel"},{default:s(()=>[l(i,{modelValue:t.value.gradeLevel,"onUpdate:modelValue":e[0]||(e[0]=n=>t.value.gradeLevel=n),class:"form-item-content",placeholder:"请选择题目年级",clearable:"",onChange:B},{default:s(()=>[e[9]||(e[9]=f(" > ")),(g(!0),V(q,null,w(z.value,n=>(g(),I(r,{key:n.key,label:n.value,value:n.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{span:6},{default:s(()=>[l(d,{label:"题目学科",name:"subjectId"},{default:s(()=>[l(i,{modelValue:t.value.subjectId,"onUpdate:modelValue":e[1]||(e[1]=n=>t.value.subjectId=n),class:"form-item-content",placeholder:"请选择题目学科",clearable:""},{default:s(()=>[e[10]||(e[10]=f(" > ")),(g(!0),V(q,null,w(h.value,n=>(g(),I(r,{key:n.id,label:n.name+" ( "+n.levelName+" )",value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{span:12},{default:s(()=>[l(d,{name:"title",help:"添加填空点击后，在题目标答中会自动生成填空题的序号和内容填充，不要随意更改内容！删除填空请将<span class='gapfilling-span'>序号</span>全部删除！"},{label:s(()=>[e[12]||(e[12]=c("span",null,"题目主干",-1)),l(b,{style:{"margin-left":"10px"},size:"small",theme:"primary",onClick:H},{default:s(()=>e[11]||(e[11]=[f("添加填空")])),_:1})]),default:s(()=>[l(K,{ref_key:"titleRef",ref:E,modelValue:t.value.title,"onUpdate:modelValue":e[2]||(e[2]=n=>t.value.title=n),class:"form-item-content",placeholder:"请输入题目主干"},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:12},{default:s(()=>[l(d,{"required-mark":""},{label:s(()=>e[13]||(e[13]=[c("span",null,"题目标答",-1)])),default:s(()=>[l(R,{gutter:[8,8],style:{"margin-top":"10px",width:"100%"}},{default:s(()=>[(g(!0),V(q,null,w(t.value.items,n=>(g(),I(m,{key:n.prefix,span:12},{default:s(()=>[c("div",fe,[c("div",pe,[l(W,{prepend:n.prefix},{append:s(()=>[l(j,{modelValue:n.score,"onUpdate:modelValue":y=>n.score=y,"auto-width":"","decimal-places":1,min:0,class:"form-item-content",placeholder:"请输入分数"},null,8,["modelValue","onUpdate:modelValue"])]),default:s(()=>[l(L,{modelValue:n.content,"onUpdate:modelValue":y=>n.content=y,placeholder:"请输入题目选项内容"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prepend"])])])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),l(m,{span:12},{default:s(()=>[l(d,{label:"解析",name:"analyze"},{default:s(()=>[l(L,{modelValue:t.value.analyze,"onUpdate:modelValue":e[3]||(e[3]=n=>t.value.analyze=n),class:"form-item-content",placeholder:"请输入解析"},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:6},{default:s(()=>[l(d,{label:"分数",name:"score"},{default:s(()=>[l(j,{modelValue:t.value.score,"onUpdate:modelValue":e[4]||(e[4]=n=>t.value.score=n),"auto-width":"","decimal-places":1,min:0,class:"form-item-content",placeholder:"请输入分数"},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:6},{default:s(()=>[l(d,{label:"难度",name:"difficult"},{default:s(()=>[l(X,{modelValue:t.value.difficult,"onUpdate:modelValue":e[5]||(e[5]=n=>t.value.difficult=n),class:"form-item-content","show-text":"",texts:["入门","简单","中等","困难","专家"]},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),c("div",ge,[c("div",ve,[c("div",_e,[l(b,{theme:"primary",class:"form-submit-confirm",type:"submit"},{default:s(()=>[f(C(t.value.id?"修改":"添加")+"题目 ",1)]),_:1}),l(b,{class:"form-submit-confirm",onClick:$},{default:s(()=>e[14]||(e[14]=[f(" 预览题目 ")])),_:1}),l(b,{type:"reset",class:"form-submit-cancel",theme:"default",variant:"base"},{default:s(()=>e[15]||(e[15]=[f(" 重置题目 ")])),_:1})])])])]),_:1},8,["data"]),l(re,{visible:p.dialog,"onUpdate:visible":e[6]||(e[6]=n=>p.dialog=n),question:p.question,"q-type":p.qType},null,8,["visible","question","q-type"])]),_:1},8,["loading"])])}}}),Ie=ue(be,[["__scopeId","data-v-fa46ae09"]]);export{Ie as default};
